package bottomtoup

import "math"

func MergeSort(nums []int, n int) {

	// ç¬¬ä¸€å±‚éå†ä¸ºå¯¹è¿›è¡Œ merge çš„å…ƒç´ ä¸ªæ•°è¿›è¡Œéå†ï¼Œä»ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹éå†ï¼Œæ¯æ¬¡å¢åŠ ä¸¤ä¸ª
	// ä¹Ÿå°±æ˜¯è¯´ï¼Œç¬¬ä¸€è½®å½’å¹¶æ’åºï¼Œæ¯æ¬¡åªçœ‹ä¸€ä¸ªå…ƒç´ ï¼Œç¬¬äºŒè½®çœ‹ä¸¤ä¸ªå…ƒç´ ï¼Œç¬¬ä¸‰è½®çœ‹å››ä¸ªå…ƒç´ ï¼Œä»¥æ­¤ç±»æ¨â€¦â€¦
	for sz := 1; sz <= n; sz += sz {

		// ç¬¬äºŒå±‚å¾ªç¯ä¸ºå…·ä½“æ¯ä¸€è½®åœ¨å½’å¹¶çš„è¿‡ç¨‹ä¸­èµ·å§‹çš„å…ƒç´ ä½ç½®ï¼Œæ¯æ¬¡ i çš„ä½ç½®çš„å¹³ç§»ä¸º 2 ä¸ª size
		// ä¹Ÿå°±æ˜¯è¯´ï¼Œç¬¬ä¸€è½®ï¼Œå°†ä» [0...size-1]å’Œä» [size...2size-1] è¿™ä¸¤éƒ¨åˆ†è¿›è¡Œä¸€æ¬¡å½’å¹¶ï¼Œç¬¬äºŒè½®å°†å¯¹ [2size...3size-1] å’Œ [3size...4size-1] è¿™ä¸¤éƒ¨åˆ†è¿›è¡Œå½’å¹¶
		for i := 0; i+sz < n; i += sz + sz {

			// å¯¹ arr[i...i+sz-1] å’Œ arr[i+sz...i+2*sz-1] è¿›è¡Œå½’å¹¶
			merge(nums, i, i+sz-1, int(math.Min(float64(i+sz+sz-1), float64(n-1))))
		}
	}
}

func merge(nums []int, l, r, mid int) {
	aux := make([]int, r-l+1)
	for i := l; i <= r; i++ {
		aux[i-l] = nums[i]
	}
	// ğŸŒ€ i å’Œ j æŒ‡å‘å½“å‰æ­£åœ¨è€ƒè™‘çš„å…ƒç´ ï¼Œk æŒ‡å‘ i å’Œ j ç›¸æ¯”è¾ƒåçš„æœ€ç»ˆå…ƒç´ åº”è¯¥æ”¾å…¥çš„æ•°ç»„çš„ä½ç½®
	i, j := l, mid+1
	for k := l; k <= r; k++ {
		if i > mid {
			nums[k] = aux[j-l]
			j++
		} else if j > r {
			nums[k] = aux[i-l]
			i++
		} else if aux[i-l] > aux[j-l] {
			nums[k] = aux[j-l]
			j++
		} else {
			nums[k] = aux[i-l]
			i++
		}
	}
}
